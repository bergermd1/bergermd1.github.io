<!DOCTYPE html>
<?php
    $con = new mysqli("localhost", "test", "test", "emails");
    if (!$con) {
        echo "failed to connect";
        die($con);
    } else {
        echo "connection successful";
    }
?>

<head>
    <link rel="stylesheet" href="style 8.css">
</head>
<body>
    <script src="./recipe search 6.js"></script>
    <!-- <script src="./recipe search/ingredient search.js"></script> -->

    <div class="title-container">
        <img src="Images/World Map Spices 2.jpg" class="title-image">
        <h1 class="title">Around the World in 197 Plates</h1>
    </div>
    <nav class="navigation">
        <ul class="nav-list">
            <li class="nav-item">
                <a class="nav-item-link" href="/index 3.html">Home</a>
            </li>
            <li class="nav-item">|</li>
            <li class="nav-item">
                <a class="nav-item-link" href="/donate 3.html">Donate</a>
            </li>
            <li class="nav-item">|</li>
            <li class="nav-item">
                <a class="nav-item-link" href="/World Map test 7.html">World Recipe Map</a>
            </li>
            <li class="nav-item">|</li>
            <li class="nav-item">
                <a class="nav-item-link" href="#">Recipe Search</a>
            </li>
        </ul>
    </nav>

    <!-- <input type="text" id="searchbox"> -->
    <!-- <button onclick="search()">Search</button> -->
    
    <br>
    <input id="searchbox" placeholder="Enter an ingredient...">
    <br><br>
    <div class="search-container">
        <div class="search-left-panel">
            <p id="ingredient-results"></p>
        </div>
        <div class="search-center-panel" id="selected-ingredients">
            <!-- <p class="selected-ingredients" > -->
                
            <!-- </p> -->
        </div>
        <div class="search-right-panel">
            <div class="log-in-dialog">
                <input id="password" placeholder="Password...">
                <button id="password-submit">Submit</button>
                <span>&nbsp&nbsp&nbsp&nbsp</span>
                <span class="search-result-text" id="search-result-text"></span>
            </div>
            <div class="country-results" id="country-results"></div>
        </div>
    </div>
    <!-- <br><br><br> -->

    <script>
        //initialize  all ingredient checkbox results and set display to none
        document.getElementById('ingredient-results').innerHTML = getIngredientListHTML();
        document.getElementById(`searchbox`).focus();
        const searchbox = document.getElementById('searchbox');
        const passwordSubmit = document.getElementById('password-submit');
        // const result = document.getElementById('result');

        //to update search results every time the input changes
        searchbox.addEventListener('input', search);
        passwordSubmit.addEventListener('click', tryLogIn);

        function tryLogIn() {//check password and repaint search results
            checkPassword(document.getElementById('password').value);
            repaintCountryResults();
        }

        const results = getIngredientSearchResults(document.getElementById('searchbox').value);
            // console.log('yeah' + results);
            results.forEach(element => {
                document.getElementById(`${element}checkbox`).style.display = "inline-block";
                document.getElementById(`${element}label`).style.display = "inline-block"; 
            });
        
        function repaintCountryResults() {
            const countryList = getCountriesFromIngredients(getCheckedIngredients());
            console.log(countryList);
            document.getElementById('country-results').innerHTML = getSearchResultHTML(countryList);
            document.getElementById('search-result-text').innerHTML = `Number of search results: ${countryList.length}`;
        }

        getIngredientListArray().forEach(element => {
            document.getElementById(`${element}checkbox`).addEventListener('change', () => {
                repaintCountryResults();
                if (document.getElementById(`${element}checkbox`).checked) {
                    document.getElementById(`${element}checkbox`).style.display = "none";
                    document.getElementById(`${element}label`).style.display = "none";    
                } else {
                    document.getElementById(`${element}checkbox`).style.display = "inline-block";
                    document.getElementById(`${element}label`).style.display = "inline-block";
                    window.scrollTo(0,0);
                }
                document.getElementById('selected-ingredients').innerHTML = getSelectedIngredientsHTML(getCheckedIngredients());
                document.getElementById(`searchbox`).value = "";
                document.getElementById(`searchbox`).focus();
                const results = getIngredientSearchResults(document.getElementById('searchbox').value);
                results.forEach(element => {
                    document.getElementById(`${element}checkbox`).style.display = "inline-block";
                    document.getElementById(`${element}label`).style.display = "inline-block"; 
                });
            })
        })

        function search() {
            // searchCountries();
            searchIngredients();
        }

        function searchCountries() {
            const results = getCountrySearchResults(document.getElementById('searchbox').value);
            // document.getElementById('country-results').innerHTML = results;
        }

        //display all ingredients that match current search input 
        function searchIngredients() {
            //blank all current search results
            getIngredientListArray().forEach(element => {
                document.getElementById(`${element}checkbox`).style.display = "none";
                document.getElementById(`${element}label`).style.display = "none";
            });
            //make visible only new search results
            const results = getIngredientSearchResults(document.getElementById('searchbox').value);
            results.forEach(element => {
                document.getElementById(`${element}checkbox`).style.display = "inline-block";
                document.getElementById(`${element}label`).style.display = "inline-block"; 
            });
            // document.getElementById('country-results').innerHTML = getCountriesFromIngredients(getCheckedIngredients());
        }

        //return array of all currently checked ingredients
        function getCheckedIngredients() {
            let checkedIngredients = [];
            getIngredientListArray().forEach(element => {
                if (document.getElementById(`${element}checkbox`).checked) {
                    checkedIngredients.push(element);
                }
            })
            return checkedIngredients;
        }
    </script>

</body>